<%-include("../../views/partials/adminPartial/header")%>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Category</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
  </style>
</head>

<body class="bg-[#0f172a] text-[#f1f5f9] min-h-screen">

  <!-- MAIN CONTAINER -->
  <div class="w-full max-w-xl mx-auto px-4 py-10">

    <!-- Back Button -->
    <button 
      onclick="window.history.back()" 
      class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded mb-6">
      â¬… Go Back
    </button>

    <h3 class="text-2xl font-semibold mb-4">Add Categories</h3>

    <!-- Card -->
    <div class="bg-[#1e293b] p-6 rounded-xl shadow-lg">

      <form id="addCategoryForm" class="space-y-5">

        <!-- Category Name -->
        <div>
          <label for="categoryName" class="block mb-1 font-medium">Category Name:</label>
          <p class="text-red-400 text-sm" id="Category-name-error"></p>
          <input type="text" 
                 id="categoryName" 
                 name="name"
                 maxlength="25"
                 placeholder="Category Name"
                 class="w-full p-3 rounded bg-[#f8fafc] text-black outline-none focus:ring-2 focus:ring-cyan-400">
        </div>

        <!-- Description -->
        <div>
          <label for="categoryDescription" class="block mb-1 font-medium">Description:</label>
          <p class="text-red-400 text-sm" id="Category-Description-error"></p>
          <textarea id="categoryDescription" 
                    name="description"
                    maxlength="150"
                    rows="3"
                    placeholder="Description"
                    class="w-full p-3 rounded bg-[#f8fafc] text-black outline-none focus:ring-2 focus:ring-cyan-400"></textarea>
        </div>

        <!-- Offer -->
        <div>
          <label for="categoryOffer" class="block mb-1 font-medium">Offer (%):</label>
          <p class="text-red-400 text-sm" id="Category-Offer-error"></p>
          <input type="number"
                 id="categoryOffer"
                 placeholder="Offer in percent"
                 class="w-full p-3 rounded bg-[#f8fafc] text-black outline-none focus:ring-2 focus:ring-cyan-400">
        </div>

        <!-- Status -->
        <div>
          <label for="status" class="block mb-1 font-medium">Status:</label>
          <select id="status" 
                  name="status"
                  class="w-full p-3 rounded bg-[#f8fafc] text-black outline-none focus:ring-2 focus:ring-cyan-400">
            <option value="" selected disabled>Select status</option>
            <option value="Listed">Listed</option>
            <option value="Unlisted">Unlisted</option>
          </select>
        </div>

        <!-- Submit -->
        <button type="submit"
                class="w-full bg-cyan-400 hover:bg-cyan-300 text-black font-semibold py-3 rounded-lg mt-4 transition">
          ADD CATEGORY
        </button>

      </form>

    </div>
  </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
   


    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('addCategoryForm');

        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          document.getElementById("Category-name-error").textContent = "";
          document.getElementById("Category-Description-error").textContent = "";
          document.getElementById("Category-Offer-error").textContent = "";

          const name = document.getElementById('categoryName').value.trim();
          const description = document.getElementById('categoryDescription').value.trim();
          const offer = document.getElementById('categoryOffer').value.trim();
          const status = document.getElementById('status').value;

          let isValid = true;

          if (!name || !/^[A-Za-z ,.-]+$/.test(name) || name.replace(/\s/g, "") === "") {
            document.getElementById("Category-name-error").textContent = "Name must contain only letters and spaces, and cannot be empty or just spaces.";
            isValid = false;
          }

          if (!description || !/^[A-Za-z ,.-]+$/.test(description) || description.replace(/\s/g, "") === "") {
            document.getElementById("Category-Description-error").textContent = "Description must contain only letters and spaces, and cannot be empty or just spaces.";
            isValid = false;
          }

          if (offer) {
            const offerValue = parseFloat(offer);
            if (isNaN(offerValue) || offerValue <= 0 || offerValue >= 100) {
              document.getElementById("Category-Offer-error").textContent = "Offer must be a number between 1 and 99.";
              isValid = false;
            }
          }

          if (!status) {
            Swal.fire({
              icon: 'error',
              title: 'Status Required',
              text: 'Please select a status.',
              confirmButtonColor: '#ef4444'
            });
            isValid = false;
          }

          if (!isValid) return;

          try {
            const response = await axios.post('/admin/categories/add-category', {
              name,
              description,
              offer,
              status
            });

            if (response.data.success) {
              Swal.fire({
                icon: 'success',
                title: 'Category Added!',
                text: response.data.message,
                confirmButtonColor: '#22c55e'
              }).then(() => {
                window.location.href = '/admin/categories';
              });
              form.reset();
            }
          } catch (error) {
            const msg = error.response?.data?.error;
            console.log('kick',error)
            if (msg === "Category already exists") {
              document.getElementById("Category-name-error").textContent = "This category name already exists.";
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: msg || 'Something went wrong!',
                confirmButtonColor: '#ef4444'
              });
            }
          }
        });
      });
    </script>

  </body>

  </html>