<%- include("../../views/partials/adminPartial/header") %>
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body {
    background-color: #0f172a;
    color: #f1f5f9;
    font-family: 'Segoe UI', sans-serif;
  }

  .main-content {
    margin-left: 240px;
    padding: 30px;
  }

  @media (max-width: 991px) {
    .main-content {
      margin-left: 0 !important;
    }
  }
</style>

<body>
  <div class="main-content">

    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold">Orders</h3>
      <button onclick="window.history.back()" class="bg-gray-700 text-white px-4 py-2 rounded">
        ⬅ Go Back
      </button>
    </div>

    <!-- Search -->
    <div class="mb-4">
      <input type="text" id="orderSearch"
        class="w-full bg-[#1e293b] text-white p-3 rounded outline-none focus:ring-2 focus:ring-cyan-400"
        placeholder="Search for Order Id">
    </div>

    <!-- DESKTOP TABLE (laptop view) -->
    <div class="hidden md:block bg-[#1e293b] rounded-lg overflow-x-auto">
      <table class="w-full text-center text-white">
        <thead class="bg-black">
          <tr>
            <th class="p-3">USER NAME</th>
            <th class="p-3">ORDER</th>
            <th class="p-3">ITEMS</th>
            <th class="p-3">AMOUNT</th>
            <th class="p-3">ORDER DATE</th>
            <th class="p-3">STATUS</th>
            <th class="p-3">ACTION</th>
          </tr>
        </thead>
        <tbody>
          <% orders.forEach(order => { %>
          <tr class="border-b border-gray-700">
            <td class="p-3 text-gray-200"><%= order.userId.name %></td>

            <td class="p-3 text-gray-200">
              <%= order.orderId %>
              <div class="flex gap-2 justify-center mt-1">
                <% order.orderedItems.forEach(i => { %>
                  <img src="<%= i.productImage %>" class="w-14 h-14 rounded object-cover" />
                <% }) %>
              </div>
            </td>

            <td class="p-3 text-gray-200">NO: <%= order.orderedItems.length %></td>
            <td class="p-3 text-gray-200">₹ <%= order.finalAmount.toFixed(2) %></td>
            <td class="p-3 text-gray-200"><%= order.createdOn.toDateString() %></td>

            <td class="p-3">
              <% if (order.status === 'Delivered') { %>
                <span class="bg-green-600 text-white px-3 py-1 rounded">Delivered</span>
              <% } else if (order.status === 'Cancelled') { %>
                <span class="bg-red-600 text-white px-3 py-1 rounded">Cancelled</span>
              <% } else { %>
                <span class="bg-yellow-500 text-white px-3 py-1 rounded"><%= order.status %></span>
              <% } %>
            </td>

            <td class="p-3">
              <button data-id="<%= order._id %>" class="viewDetail bg-cyan-400 text-black px-3 py-1 rounded">
                View Detail
              </button>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <!-- MOBILE VIEW (cards) -->
    <div class="md:hidden space-y-4">
      <% orders.forEach(order => { %>
      <div class="bg-[#1e293b] p-4 rounded-lg shadow border border-gray-700">

        <div class="flex justify-between">
          <h4 class="text-lg font-semibold"><%= order.userId.name %></h4>
          <p class="text-sm text-gray-300">#<%= order.orderId %></p>
        </div>

        <div class="mt-2 flex gap-2 overflow-x-auto pb-2">
          <% order.orderedItems.forEach(i => { %>
            <img src="<%= i.productImage %>" class="w-20 h-20 rounded object-cover" />
          <% }) %>
        </div>

        <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
          <p><span class="text-gray-400">Items:</span> <%= order.orderedItems.length %></p>
          <p><span class="text-gray-400">Amount:</span> ₹<%= order.finalAmount.toFixed(2) %></p>
          <p><span class="text-gray-400">Date:</span> <%= order.createdOn.toDateString() %></p>

          <p class="mt-1">
            <span class="text-gray-400">Status:</span><br>
            <% if(order.status === 'Delivered') { %>
              <span class="bg-green-600 text-white px-2 py-1 rounded text-xs">Delivered</span>
            <% } else if(order.status === 'Cancelled') { %>
              <span class="bg-red-600 text-white px-2 py-1 rounded text-xs">Cancelled</span>
            <% } else { %>
              <span class="bg-yellow-500 text-white px-2 py-1 rounded text-xs"><%= order.status %></span>
            <% } %>
          </p>
        </div>

        <div class="mt-4 flex justify-end">
          <button data-id="<%= order._id %>"
            class="viewDetail bg-cyan-400 text-black px-3 py-2 rounded font-semibold">
            View Detail
          </button>
        </div>

      </div>
      <% }) %>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-3">

  <div>Showing <%= currentPage %> of <%= totalPages %></div>

  <nav>
    <ul class="pagination mb-0">

      <!-- Previous button -->
      <li class="page-item <%= currentPage == 1 ? 'disabled' : '' %>">
        <a class="page-link" 
           href="?page=<%= currentPage - 1 %>&search=<%= search %>">‹</a>
      </li>

      <!-- CURRENT PAGE ONLY -->
      <li class="page-item active">
        <a class="page-link" href="#">
          <%= currentPage %>
        </a>
      </li>

      <!-- Next button -->
      <li class="page-item <%= currentPage == totalPages ? 'disabled' : '' %>">
        <a class="page-link" 
           href="?page=<%= currentPage + 1 %>&search=<%= search %>">›</a>
      </li>

    </ul>
  </nav>

</div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.viewDetail').forEach(button => {
        button.addEventListener('click', function () {
          const orderId = this.dataset.id;
          window.location.href = `/admin/orders/orderDetails/${orderId}`;
        });
      });

      document.getElementById('orderSearch').addEventListener('keyup', function () {
        let searchValue = this.value.toLowerCase();
        let rows = document.querySelectorAll('tbody tr');
        rows.forEach(row => {
          let orderId = row.children[1].textContent.toLowerCase();
          if (orderId.includes(searchValue)) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });
    });
    document.getElementById("orderSearch").addEventListener("input", function () {
    const searchValue = this.value.toLowerCase();
    console.log("Searching for:", searchValue);
  });
  </script>
</body>

</html>